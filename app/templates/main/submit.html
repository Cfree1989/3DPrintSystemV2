{% extends "base.html" %}

{% block title %}Submit 3D Print Job{% endblock %}

{% block head_extra %}
    {# If not using a global Tailwind CDN link in base.html, add it here for this page #}
    <script src="https://cdn.tailwindcss.com"></script> {# Temporary for quick styling #}
    <style>
      /* Add some basic spacing for form elements if not covered by wtf or tailwind defaults */
      .form-group {
        margin-bottom: 1rem;
      }
      label {
        display: block;
        margin-bottom: 0.25rem;
        font-weight: bold;
      }
      input[type="text"],
      input[type="email"],
      select {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ccc;
        border-radius: 0.25rem;
      }
      .form-check-label {
        font-weight: normal;
      }
      .error-message {
        color: red;
        font-size: 0.875rem;
      }
    </style>
{% endblock %}

{% block content %}
<div class="container mx-auto p-8">
    <h2 class="text-2xl font-bold mb-6">Submit New 3D Print Job</h2>

    {# Flash messages #}
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="p-4 mb-4 text-sm rounded-lg \
            {% if category == 'success' %} bg-green-100 text-green-700 {% endif %}\
            {% if category == 'error' %} bg-red-100 text-red-700 {% endif %}\
            {% if category == 'info' %} bg-blue-100 text-blue-700 {% endif %}\
            {% if category == 'warning' %} bg-yellow-100 text-yellow-700 {% endif %}" \
            role="alert">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST" enctype="multipart/form-data" novalidate>
        {{ form.hidden_tag() }} {# CSRF token #}

        <div class="form-group">
            {{ form.student_name.label(class="block text-sm font-medium text-gray-700") }}
            {{ form.student_name(class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm", placeholder="e.g., Jane Doe") }}
            {% for error in form.student_name.errors %}
                <p class="error-message">{{ error }}</p>
            {% endfor %}
        </div>

        <div class="form-group">
            {{ form.student_email.label(class="block text-sm font-medium text-gray-700") }}
            {{ form.student_email(class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm", placeholder="e.g., jane.doe@example.edu") }}
            {% for error in form.student_email.errors %}
                <p class="error-message">{{ error }}</p>
            {% endfor %}
        </div>

        <div class="form-group">
            {{ form.discipline.label(class="block text-sm font-medium text-gray-700") }}
            {{ form.discipline(class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm") }}
            {% for error in form.discipline.errors %}
                <p class="error-message">{{ error }}</p>
            {% endfor %}
        </div>

        <div class="form-group">
            {{ form.class_number.label(class="block text-sm font-medium text-gray-700") }}
            {{ form.class_number(class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm", placeholder="e.g., ARCH-101 or N/A") }}
            {% for error in form.class_number.errors %}
                <p class="error-message">{{ error }}</p>
            {% endfor %}
        </div>
        
        <div class="form-group">
            {{ form.print_method.label(class="block text-sm font-medium text-gray-700") }}
            {{ form.print_method(class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm") }}
            {% for error in form.print_method.errors %}
                <p class="error-message">{{ error }}</p>
            {% endfor %}
        </div>

        <div class="form-group">
            {{ form.color_preference.label(class="block text-sm font-medium text-gray-700") }}
            {{ form.color_preference(class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm") }}
            {% for error in form.color_preference.errors %}
                <p class="error-message">{{ error }}</p>
            {% endfor %}
        </div>

        <div class="form-group">
            <p class="block text-sm font-medium text-gray-700 mb-1">{{ form.model_scaled_correctly.label.text }}</p>
            {% for subfield in form.model_scaled_correctly %}
                <label class="inline-flex items-center mr-4">
                    {{ subfield(class="form-radio h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500") }}
                    <span class="ml-2 text-sm text-gray-700">{{ subfield.label.text }}</span>
                </label>
            {% endfor %}
            {% for error in form.model_scaled_correctly.errors %}
                <p class="error-message">{{ error }}</p>
            {% endfor %}
        </div>

        <div class="form-group">
            <label class="flex items-center">
                {{ form.minimum_charge_consent(class="form-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500") }}
                <span class="ml-2 text-sm text-gray-700">{{ form.minimum_charge_consent.label.text }}</span>
            </label>
            {% for error in form.minimum_charge_consent.errors %}
                <p class="error-message">{{ error }}</p>
            {% endfor %}
        </div>
        
        <div class="form-group">
            {{ form.file_upload.label(class="block text-sm font-medium text-gray-700") }}
            {{ form.file_upload(class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500") }}
            <p class="mt-1 text-xs text-gray-500">Allowed file types: .stl, .obj, .3mf. Max file size: 50MB (server-side check).</p> {# Max size is illustrative, will be enforced server-side #}
            {% for error in form.file_upload.errors %}
                <p class="error-message">{{ error }}</p>
            {% endfor %}
        </div>

        <div class="form-group mt-6">
            {{ form.submit(class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500") }}
        </div>
    </form>
</div>
{% endblock %} 