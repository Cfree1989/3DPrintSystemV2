{% extends "base.html" %}

{% block title %}Submit 3D Print Job{% endblock %}

{% block head_extra %}
    {# If not using a global Tailwind CDN link in base.html, add it here for this page #}
    <script src="https://cdn.tailwindcss.com"></script> {# Temporary for quick styling #}
    <style>
      /* Add some basic spacing for form elements if not covered by wtf or tailwind defaults */
      .form-group {
        margin-bottom: 1rem;
      }
      label {
        display: block;
        margin-bottom: 0.25rem;
        font-weight: bold;
      }
      input[type="text"],
      input[type="email"],
      select {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ccc;
        border-radius: 0.25rem;
      }
      .form-check-label {
        font-weight: normal;
      }
      .error-message {
        color: red;
        font-size: 0.875rem;
      }
    </style>
{% endblock %}

{% block content %}
<div class="form-container">
    <h2>Submit 3D Print Job</h2>
    
    <!-- Warning Text -->
    <div class="alert alert-warning">
        <strong>Important:</strong> Before submitting your model for 3D printing, please ensure you have thoroughly reviewed our Additive Manufacturing Moodle page, read all the guides, and checked the checklist. If necessary, revisit and fix your model before submission. Your model must be scaled and simplified appropriately, often requiring a second version specifically optimized for 3D printing. We will not print models that are broken, messy, or too large. Your model must follow the rules and constraints of the machine. We will not fix or scale your model as we do not know your specific needs or project requirements. We print exactly what you send us; if the scale is wrong or you are unsatisfied with the product, it is your responsibility. We will gladly print another model for you at an additional cost. We are only responsible for print failures due to issues under our control.
    </div>

    <form method="POST" enctype="multipart/form-data" id="submitForm">
        {{ form.hidden_tag() }}

        <div class="form-group">
            {{ form.student_name.label(class="form-label") }}
            {{ form.student_name(class="form-control") }}
            {% if form.student_name.errors %}
                <div class="alert alert-error">{{ form.student_name.errors[0] }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.student_email.label(class="form-label") }}
            {{ form.student_email(class="form-control") }}
            {% if form.student_email.errors %}
                <div class="alert alert-error">{{ form.student_email.errors[0] }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.discipline.label(class="form-label") }}
            {{ form.discipline(class="form-control") }}
            {% if form.discipline.errors %}
                <div class="alert alert-error">{{ form.discipline.errors[0] }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.class_number.label(class="form-label") }}
            {{ form.class_number(class="form-control", placeholder="ARCH 4000") }}
            {% if form.class_number.errors %}
                <div class="alert alert-error">{{ form.class_number.errors[0] }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.print_method.label(class="form-label") }}
            {{ form.print_method(class="form-control", id="printMethod") }}
            {% if form.print_method.errors %}
                <div class="alert alert-error">{{ form.print_method.errors[0] }}</div>
            {% endif %}
            <div id="methodHelp" style="margin-top: 0.5rem; font-size: 0.9rem; color: #6b7280;"></div>
        </div>

        <div class="form-group">
            {{ form.color_preference.label(class="form-label") }}
            {{ form.color_preference(class="form-control", id="colorSelect", disabled=true) }}
            {% if form.color_preference.errors %}
                <div class="alert alert-error">{{ form.color_preference.errors[0] }}</div>
            {% endif %}
            <div id="colorHelp" style="margin-top: 0.5rem; font-size: 0.9rem; color: #6b7280;">Please select a print method first</div>
        </div>

        <div class="form-group">
            <label class="form-label">Printer Dimensions</label>
            <div style="margin: 0.5rem 0; padding: 1rem; background: #f3f4f6; border-radius: 6px; font-size: 0.9rem;">
                <strong>Will your model fit on our printers? Please check the dimensions (W x D x H):</strong><br>
                <strong>Filament:</strong><br>
                • Prusa MK4S: 9.84" × 8.3" × 8.6" (250 × 210 × 220 mm)<br>
                • Prusa XL: 14.17" × 14.17" × 14.17" (360 × 360 × 360 mm)<br>
                • Raise3D Pro 2 Plus: 12" × 12" × 23.8" (305 × 305 × 605 mm)<br>
                <strong>Resin:</strong><br>
                • Formlabs Form 3: 5.7 × 5.7 × 7.3 inches (145 x 145 x 175 mm)<br><br>
                Ensure your model's dimensions are within the specified limits for the printer you plan to use. If your model is too large, consider scaling it down or splitting it into parts. For more guidance, refer to the design guides on our Moodle page or ask for assistance in person. If exporting as .STL or .OBJ you MUST scale it down in millimeters BEFORE exporting. If you do not the scale will not work correctly.
            </div>
        </div>

        <div class="form-group">
            {{ form.printer_selection.label(class="form-label") }}
            {{ form.printer_selection(class="form-control") }}
            {% if form.printer_selection.errors %}
                <div class="alert alert-error">{{ form.printer_selection.errors[0] }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.minimum_charge_consent.label(class="form-label") }}
            {{ form.minimum_charge_consent(class="form-control") }}
            {% if form.minimum_charge_consent.errors %}
                <div class="alert alert-error">{{ form.minimum_charge_consent.errors[0] }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.file_upload.label(class="form-label") }}
            {{ form.file_upload(class="form-control", id="fileInput") }}
            {% if form.file_upload.errors %}
                <div class="alert alert-error">{{ form.file_upload.errors[0] }}</div>
            {% endif %}
            <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #6b7280;">
                Accepted formats: .stl, .obj, .3mf (max 50MB)
            </div>
        </div>

        <button type="submit" class="btn btn-primary" id="submitBtn">
            Submit Print Job
        </button>
    </form>
</div>

<script>
// Simple JavaScript for dynamic color selection and form validation
document.addEventListener('DOMContentLoaded', function() {
    const printMethod = document.getElementById('printMethod');
    const colorSelect = document.getElementById('colorSelect');
    const colorHelp = document.getElementById('colorHelp');
    const methodHelp = document.getElementById('methodHelp');
    const fileInput = document.getElementById('fileInput');
    const submitBtn = document.getElementById('submitBtn');
    
    // Color options
    const filamentColors = [
        ['', 'Select a color...'],
        ['True Red', 'True Red'], ['True Orange', 'True Orange'], ['Light Orange', 'Light Orange'],
        ['True Yellow', 'True Yellow'], ['Dark Yellow', 'Dark Yellow'], ['Lime Green', 'Lime Green'],
        ['Green', 'Green'], ['Forest Green', 'Forest Green'], ['Blue', 'Blue'], ['Electric Blue', 'Electric Blue'],
        ['Midnight Purple', 'Midnight Purple'], ['Light Purple', 'Light Purple'], ['Clear', 'Clear'],
        ['True White', 'True White'], ['Gray', 'Gray'], ['True Black', 'True Black'], ['Brown', 'Brown'],
        ['Copper', 'Copper'], ['Bronze', 'Bronze'], ['True Silver', 'True Silver'], ['True Gold', 'True Gold'],
        ['Glow in the Dark', 'Glow in the Dark'], ['Color Changing', 'Color Changing']
    ];
    
    const resinColors = [
        ['', 'Select a color...'],
        ['Black', 'Black'], ['White', 'White'], ['Gray', 'Gray'], ['Clear', 'Clear']
    ];
    
    // Method descriptions
    const methodDescriptions = {
        'Filament': 'Description: Good resolution, suitable for simpler models. Fast. Best For: Medium items. Cost: Least expensive.',
        'Resin': 'Description: Super high resolution and detail. Slow. Best For: Small items. Cost: More expensive.'
    };
    
    printMethod.addEventListener('change', function() {
        const method = this.value;
        colorSelect.innerHTML = '';
        
        if (method) {
            colorSelect.disabled = false;
            colorHelp.textContent = `Select a ${method.toLowerCase()} color`;
            methodHelp.textContent = methodDescriptions[method] || '';
            
            const colors = method === 'Filament' ? filamentColors : resinColors;
            colors.forEach(function(color) {
                const option = document.createElement('option');
                option.value = color[0];
                option.textContent = color[1];
                colorSelect.appendChild(option);
            });
        } else {
            colorSelect.disabled = true;
            colorHelp.textContent = 'Please select a print method first';
            methodHelp.textContent = '';
        }
    });
    
    // File validation
    fileInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const maxSize = 50 * 1024 * 1024; // 50MB
            const allowedTypes = ['.stl', '.obj', '.3mf'];
            const fileName = file.name.toLowerCase();
            const fileExt = fileName.substring(fileName.lastIndexOf('.'));
            
            if (file.size > maxSize) {
                alert('File size must be less than 50MB');
                this.value = '';
                return;
            }
            
            if (!allowedTypes.includes(fileExt)) {
                alert('Please select a valid 3D model file (.stl, .obj, or .3mf)');
                this.value = '';
                return;
            }
        }
    });
    
    // Form submission loading state
    document.getElementById('submitForm').addEventListener('submit', function() {
        submitBtn.textContent = 'Submitting...';
        submitBtn.disabled = true;
    });
});
</script>
{% endblock %} 