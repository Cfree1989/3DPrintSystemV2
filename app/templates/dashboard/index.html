{% extends "base.html" %}

{% block head_extra %}
<style>
.status-tabs {
    display: flex;
    gap: 0.25rem;
    margin-bottom: 2rem;
    border-bottom: 1px solid #e5e7eb;
    padding-bottom: 0;
    overflow-x: auto;
}

.tab-button {
    padding: 0.75rem 1rem;
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    cursor: pointer;
    font-weight: 500;
    color: #6b7280;
    transition: all 0.2s;
    white-space: nowrap;
    min-width: fit-content;
}

.tab-button:hover {
    color: #374151;
    background: #f9fafb;
}

.tab-button.active {
    color: #2563eb;
    border-bottom-color: #2563eb;
    background: #eff6ff;
}

.tab-count {
    margin-left: 0.5rem;
    background: #e5e7eb;
    padding: 0.125rem 0.375rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
}

.tab-button.active .tab-count {
    background: #2563eb;
    color: white;
}

.job-list {
    min-height: 400px;
}

.loading {
    text-align: center;
    padding: 2rem;
    color: #6b7280;
}
</style>
{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<div class="dashboard-header">
    <h1>Staff Dashboard</h1>
    <div>
        <span style="margin-right: 1rem;">Welcome, Staff</span>
        <a href="{{ url_for('dashboard.logout') }}" class="btn btn-secondary">Logout</a>
    </div>
</div>

<!-- Status Tabs (Single Row Interface) -->
<div class="status-tabs">
    <button class="tab-button {% if current_status == 'UPLOADED' %}active{% endif %}" data-status="UPLOADED">
        Uploaded<span class="tab-count">{{ stats.uploaded }}</span>
    </button>
    <button class="tab-button {% if current_status == 'PENDING' %}active{% endif %}" data-status="PENDING">
        Pending<span class="tab-count">{{ stats.pending }}</span>
    </button>
    <button class="tab-button {% if current_status == 'READYTOPRINT' %}active{% endif %}" data-status="READYTOPRINT">
        Ready to Print<span class="tab-count">{{ stats.ready }}</span>
    </button>
    <button class="tab-button {% if current_status == 'PRINTING' %}active{% endif %}" data-status="PRINTING">
        Printing<span class="tab-count">{{ stats.printing }}</span>
    </button>
    <button class="tab-button {% if current_status == 'COMPLETED' %}active{% endif %}" data-status="COMPLETED">
        Completed<span class="tab-count">{{ stats.completed }}</span>
    </button>
    <button class="tab-button {% if current_status == 'PAIDPICKEDUP' %}active{% endif %}" data-status="PAIDPICKEDUP">
        Paid/Picked Up<span class="tab-count">{{ stats.paidpickedup or 0 }}</span>
    </button>
    <button class="tab-button {% if current_status == 'REJECTED' %}active{% endif %}" data-status="REJECTED">
        Rejected<span class="tab-count">{{ stats.rejected or 0 }}</span>
    </button>
</div>

<!-- Jobs List -->
<div class="job-list">
    <div class="job-list-header">
        <h3 id="tab-title">
            {% if current_status == 'UPLOADED' %}Uploaded Jobs Awaiting Review
            {% elif current_status == 'PENDING' %}Pending Student Confirmation
            {% elif current_status == 'READYTOPRINT' %}Ready to Print
            {% elif current_status == 'PRINTING' %}Currently Printing
            {% elif current_status == 'COMPLETED' %}Completed Jobs
            {% elif current_status == 'PAIDPICKEDUP' %}Paid/Picked Up
            {% elif current_status == 'REJECTED' %}Rejected Jobs
            {% endif %}
        </h3>
        <p id="tab-description">{{ jobs|length }} job{{ 's' if jobs|length != 1 else '' }} in this status</p>
    </div>
    
    <div id="jobs-container">
        {% if jobs %}
            {% for job in jobs %}
            <div class="job-item">
                <div class="job-info">
                    <h4>{{ job.display_name }}</h4>
                    <p><strong>Student:</strong> {{ job.student_name }} ({{ job.student_email }})</p>
                    <p><strong>Method:</strong> {{ job.printer }} | <strong>Color:</strong> {{ job.color }}</p>
                    {% if job.material %}<p><strong>Material:</strong> {{ job.material }}</p>{% endif %}
                    {% if job.cost_usd %}<p><strong>Cost:</strong> ${{ job.cost_usd }}</p>{% endif %}
                    <p><strong>Submitted:</strong> {{ job.created_at.strftime('%m/%d/%Y at %I:%M %p') }}</p>
                </div>
                <div>
                    <span class="status-badge status-{{ job.status.lower() }}">{{ job.status }}</span>
                    <div style="margin-top: 0.5rem;">
                        <a href="{{ url_for('dashboard.job_detail', job_id=job.id) }}" class="btn btn-primary" style="font-size: 0.8rem; padding: 0.5rem 1rem;">View Details</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div style="padding: 3rem; text-align: center; color: #6b7280;">
                <p>No jobs in this status.</p>
                <p style="font-size: 0.9rem; margin-top: 0.5rem;">Jobs will appear here when they reach this status.</p>
            </div>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tabButtons = document.querySelectorAll('.tab-button');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const status = this.dataset.status;
            
            // Navigate to the dashboard with the selected status
            window.location.href = `{{ url_for('dashboard.index') }}?status=${status}`;
        });
    });
});
</script>
{% endblock %} 